<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Title -->
    <title>Ctrl+Park</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../../../../user_assets/user_css/style.css">
    <link rel="stylesheet" href="../../../controllers/assets/css/styles.css"> <!-- for bottom navbar -->
 
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Flatpickr CSS and JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Prevention Script -->
    <script>
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));

        if (!currentUser) {
            // Prevent any content from flashing
            document.documentElement.style.display = "none";

            // Redirect immediately
            window.location.href = "/index.html";
        }
    </script>
</head>
<body>
      <div class="container">
    <!--=============== LEFT SIDE ===============-->
        <aside class="left-section">
            <div class="logo">
                <button class="menu-btn" id="menu-close">
                    <i class='bx bx-log-out-circle'></i>
                </button>
                <img src="../../../../user_assets/user_img/logo-white.svg">
                <a href="#">Ctrl+Park</a>
            </div>

            <div class="sidebar">
                <div class="item" id="active">
                    <i class='bx bx-home-alt'></i>
                    <a href="#">Home</a>
                </div>
                <div class="item">
                    <i class='bx bx-grid-alt'></i>
                    <a href="../parking/parking.html">Parking</a>
                </div>
                <div class="item">
                    <i class='bx bx-user-circle'></i>
                    <a href="../user/user.html">Profile</a>
                </div>
            </div>

            <button id="logout-btn" class="logout-btn">
                <i class="bx bx-log-out"></i>
            </button>


        </aside>

        <!--=============== MAIN CONTENT ===============-->
        <main>
            <header>
                <button class="menu-btn" id="menu-open">
                    <i class='bx bx-menu'></i>
                </button>
                <h5>Hello <b id="userNameHeader">Guest</b>, welcome back!</h5>
            </header>

            <div class="separator">
                <div class="info">
                    <h3>Parking</h3>
                </div>
            </div>

            <div class="analytics">
                <!-- LIVE STREAM ITEM -->
                <div class="item">
                    <div class="progress video-container">
                        <div class="info">
                            <h5>Live Stream</h5>
                        </div>

                        <!-- Clickable image opens modal -->
                        <img
                            src="https://stream.bsitport2026.com/parking/video_feed"
                            alt="Live Stream"
                            id="liveStream"
                            class="clickable"
                        >
                    </div>
                </div>

                <!-- 2D MAP ITEM -->
                <div class="item1">
                    <div class="progress map-container clickable" id="mapButton">
                        <div class="info">
                            <h5>2D Map</h5>
                            <p>Navigation Graph</p>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>

                <!-- MODAL for Live Stream Zoom -->
                <div id="videoModal" class="modal">
                    <span class="close">&times;</span>
                    <div class="modal-content">
                        <img id="modalVideo" src="" alt="Expanded Live Stream">
                    </div>
                </div>
            </div>

            <!-- History -->
            <div class="separator">
                <div class="info">
                    <h3>History</h3>
                    <a href="history.html">View All</a>
                </div>
                <input type="date" id="history-calendar">
            </div>
            
            <div class="weekly">
                <div class="recent-activity"></div>
            </div>

        </main>

        <aside class="right-section">
            <div class="top">
                <!-- Bell button -->
                <button id="notifBtn" class="notif-btn">
                    <i class='bx bx-bell'></i>
                </button>

                <div class="profile">
                    <div class="left">
                        <!-- Profile Picture -->
                        <img id="user-photo" src="../../../../user_assets/user_img/default-avatar.svg" alt="User Photo" class="avatar">
                        <div class="user">
                             <!-- Name -->
                             <h5 id="user-name">Guest</h5>
     
                             <!-- Role -->                      
                            <a id="user-plan">Role</a>
                        </div>

                    </div>
                    <a href="../user/profile.html"><i class='bx bxs-chevron-right'></i></a>
                </div>
            </div>

            <div class="separator" id="first">
                <h4>Statistics</h4>
            </div>

            <div class="stats">
                <div class="item">
                    <div class="top">
                    <p>Number of</p>
                    <p>Entries</p>
                    </div>
                    <div class="bottom">
                    <div class="line"></div>
                    <h3 id="entriesCount">0</h3>
                    </div>
                </div>
                <div class="item">
                    <div class="top">
                    <p>Number of</p>
                    <p>Exits</p>
                    </div>
                    <div class="bottom">
                    <div class="line"></div>
                    <h3 id="exitsCount">0</h3>
                    </div>
                </div>
                <div class="item">
                    <div class="top">
                    <p>Total Time</p>
                    <p>Parked</p>
                    </div>
                    <div class="bottom">
                    <div class="line"></div>
                    <h3 id="totalTime">0</h3>
                    </div>
                </div>
                <!-- <div class="item">
                    <div class="top">
                    <p>Violations</p>
                    </div>
                    <div class="bottom">
                    <div class="line"></div>
                    <h3 id="violationsCount">0</h3>
                    </div>
                </div> -->
            </div>
        </aside>

    </div>
        
    <!--=============== BOTTOM NAVBAR ===============-->
    <header class="header" id="header">
        <nav class="nav container">

            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                <li class="nav__item">
                    <a href="#" class="nav__link active-link">
                    <i class='bx bx-home-alt nav__icon'></i>
                    <span class="nav__name">Home</span>
                    </a>
                </li>

                <li class="nav__item">
                    <a href="../parking/parking.html" class="nav__link">
                    <i class='bx bx-grid-alt nav__icon'></i>
                    <span class="nav__name">Parking</span>
                    </a>
                </li>

                <li class="nav__item">
                    <a href="../user/user.html" class="nav__link">
                    <i class='bx bx-user-circle nav__icon'></i>
                    <span class="nav__name">Profile</span>
                    </a>
                </li>

                </ul>
            </div>
        </nav>
    </header>

    <!-- Scripts -->
    <script src="assets/js/main.js"></script>
    <script type="module" src="../../../../../main_assets/js/authentication/user_reg.js"></script>
    <script src="../../../../user_assets/user_js/user_script.js"></script>
    <script type="module" src="../../../authentication/user_log.js"></script>
    <script type="module" src="../../../../../admin_app/admin_assets/admin_js/admin_map.js"></script>
    <script type="module" src="../../../../user_assets/user_js/history.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
        // --- Modal logic for video ---
        const liveStream = document.getElementById("liveStream");
        const modal = document.getElementById("videoModal");
        const modalVideo = document.getElementById("modalVideo");
        const closeModal = document.querySelector(".close");

        liveStream.addEventListener("click", () => {
            modal.style.display = "block";
            modalVideo.src = liveStream.src;
        });

        closeModal.addEventListener("click", () => {
            modal.style.display = "none";
            modalVideo.src = "";
        });

        window.addEventListener("click", (event) => {
            if (event.target === modal) {
            modal.style.display = "none";
            modalVideo.src = "";
            }
        });

        // --- Redirect for map button ---
        document.getElementById("mapButton").addEventListener("click", () => {
            window.location.href = "../parking/parking.html";
        });
        });

        // --- Button ---
        document.getElementById("notifBtn").addEventListener("click", () => {
            window.location.href = "../user/notifications.html"; 
        });
    </script>

</body>

</html>
